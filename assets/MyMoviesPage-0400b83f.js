import{a as k,r as d,u as I,j as e,b as F,c as A,f as D,d as P,e as S}from"./index-8bc32b2d.js";import{i as M,E as q,s as a,M as G,g as R,a as N}from"./movies-selectors-1f717ff7.js";import{u as B,T as w}from"./useForm-42c5b676.js";const U="_list_1d4xt_1",Y="_listItem_1d4xt_10",L="_posterWrapper_1d4xt_22",W="_listItemPoster_1d4xt_34",V="_listItemInfo_1d4xt_46",K="_like_1d4xt_60",O="_likeActive_1d4xt_70",z="_video_1d4xt_75",H="_button_1d4xt_92",J="_btnEdit_1d4xt_115",Q="_modal_1d4xt_141",X="_modalContent_1d4xt_154",Z="_close_1d4xt_171",o={list:U,listItem:Y,posterWrapper:L,listItemPoster:W,listItemInfo:V,like:K,likeActive:O,video:z,button:H,btnEdit:J,modal:Q,modalContent:X,close:Z},E="https://api.themoviedb.org/3",$="ba520957137ad46ba4502dabb5237445",ee=async r=>{try{const t=await k.get(`${E}/search/movie?api_key=${$}&query=${encodeURIComponent(r)}&page=1`);if(t.data.results.length===0)throw new Error("No movies found for the provided query");return t.data.results[0]}catch(t){throw console.error("Error fetching movie by name:",t),t}},te=async r=>{try{const s=(await k.get(`${E}/movie/${r}/videos?api_key=${$}`)).data.results.filter(l=>l.type==="Trailer"&&l.site==="YouTube");if(s.length>0)return s[0];throw new Error("Trailer not found")}catch(t){throw console.error("Error fetching movie trailer:",t),t}},se=async r=>{try{const t=await ee(r);console.log(`Found movie: ${t.title} (ID: ${t.id})`);const s=await te(t.id);return console.log(`Found trailer: ${s.name} (Key: ${s.key})`),`https://www.youtube.com/embed/${s.key}`}catch(t){throw console.error("Error finding and playing trailer:",t),t}},oe="http://localhost:4444",re=({items:r,onDeleteMovie:t})=>{const s=d.useRef(null),l=I(),[c,m]=d.useState(!1),[j,h]=d.useState(""),[u,x]=d.useState(""),v=(n,i)=>{l(F({id:n,favorite:!i}))},p=async n=>{try{const i=await se(n);h(i),m(!0)}catch(i){x(i.message||"An unexpected error occurred.")}},T=()=>{m(!1),h(""),x("")},C=r.map(({_id:n,title:i,director:y,genre:b,poster:f,releaseDate:g,favorite:_})=>e.jsxs("li",{className:o.listItem,children:[f&&e.jsx("div",{className:o.posterWrapper,children:e.jsx("img",{ref:s,className:o.listItemPoster,src:`${oe}/${f}`,alt:`Poster for ${i}`})}),e.jsxs("div",{className:o.listItemInfo,children:[e.jsxs("h2",{children:["Назва: ",i]}),e.jsxs("span",{children:["Director: ",y]}),e.jsxs("span",{children:["Genre: ",b]}),e.jsxs("span",{children:["Release: ",g]})]}),e.jsx("button",{children:e.jsx("svg",{onClick:()=>v(n,_),className:`${o.like} ${_?o.likeActive:""}`,children:e.jsx("use",{href:`${M}#icon-heart`})})}),e.jsx("button",{onClick:()=>p(i),children:e.jsx("svg",{className:o.video,children:e.jsx("use",{href:`${M}#icon-video`})})}),e.jsx("button",{className:o.button,onClick:()=>t(n),children:"Delete"}),e.jsx(q,{movie:{_id:n,title:i,director:y,genre:b,poster:f,releaseDate:g,favorite:_},className:o.btnEdit})]},n));return e.jsxs("div",{children:[e.jsx("ol",{className:o.list,children:C}),c&&e.jsx("div",{className:o.modal,children:e.jsxs("div",{className:o.modalContent,children:[e.jsx("button",{className:o.close,onClick:T,children:"×"}),u?e.jsx("p",{className:o.error,children:u}):e.jsx("iframe",{width:"560",height:"315",src:j,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:"Trailer"})]})})]})},ae={title:"",director:"",favorite:!1,genre:"fantastic",releaseDate:"",poster:null},ie=({onSubmit:r})=>{const{state:t,handleChange:s,reset:l}=B({initialState:ae,onSubmit:r}),c=v=>{v.preventDefault();const p=new FormData(v.currentTarget);p.set("favorite",t.favorite),r(p),l()},{title:m,director:j,favorite:h,releaseDate:u}=t,x=[/\d/,/\d/,/\d/,/\d/];return e.jsxs("form",{onSubmit:c,className:a.form,encType:"multipart/form-data",children:[e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie title"}),e.jsx("input",{value:m,name:"title",onChange:s,className:a.textField,placeholder:"Movie title",required:!0})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie director"}),e.jsx("input",{value:j,name:"director",onChange:s,className:a.textField,placeholder:"Movie director",required:!0})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Favorite"}),e.jsx("input",{checked:h,name:"favorite",onChange:s,className:a.checkbox,type:"checkbox"})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie genre"}),e.jsxs("select",{name:"genre",onChange:s,children:[e.jsx("option",{value:"fantastic",children:"Fantastic"}),e.jsx("option",{value:"love story",children:"Love story"})]})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie release date"}),e.jsx(G,{mask:x,value:u,name:"releaseDate",onChange:s,className:a.textField,placeholder:"YYYY",required:!0})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Poster"}),e.jsx("input",{name:"poster",type:"file"})]}),e.jsx("button",{className:a.btn,type:"submit",children:"Add movie"})]})},le="_title_xta3q_1",ne="_blocks_xta3q_8",ce={title:le,blocks:ne},de=()=>{const r=A(R),t=I();d.useEffect(()=>{t(D())},[t]);const s=c=>{t(P(c))},l=c=>{t(S(c))};return e.jsx("div",{children:e.jsxs("div",{className:ce.blocks,children:[e.jsx(N,{title:"Add movie",children:e.jsx(ie,{onSubmit:s})}),e.jsx(N,{title:"Movie list",children:r.length>0?e.jsx(re,{items:r,onDeleteMovie:l}):e.jsx(w,{children:"No movies have been added yet"})})]})})},xe=()=>e.jsxs("div",{children:[e.jsx(w,{children:"My movies page"}),e.jsx(de,{})]});export{xe as default};
