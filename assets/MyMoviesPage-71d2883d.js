import{a as I,j as e,r as d,u as $,b as A,c as D,f as P,d as S,e as q}from"./index-3e199ad9.js";import{i as N,E as G,s as r,M as R,g as U,a as k}from"./movies-selectors-6d9203e3.js";import{u as B,T as w}from"./useForm-d14d4e70.js";const Y="_list_1io6v_1",L="_listItem_1io6v_10",W="_posterWrapper_1io6v_22",O="_listItemPoster_1io6v_34",V="_listItemInfo_1io6v_46",K="_like_1io6v_60",z="_likeActive_1io6v_70",H="_video_1io6v_75",J="_button_1io6v_92",Q="_btnEdit_1io6v_115",l={list:Y,listItem:L,posterWrapper:W,listItemPoster:O,listItemInfo:V,like:K,likeActive:z,video:H,button:J,btnEdit:Q},E="https://api.themoviedb.org/3",T="ba520957137ad46ba4502dabb5237445",X=async o=>{try{const s=await I.get(`${E}/search/movie?api_key=${T}&query=${encodeURIComponent(o)}&page=1`);if(s.data.results.length===0)throw new Error("No movies found for the provided query");return s.data.results[0]}catch(s){throw console.error("Error fetching movie by name:",s),s}},Z=async o=>{try{const t=(await I.get(`${E}/movie/${o}/videos?api_key=${T}`)).data.results.filter(i=>i.type==="Trailer"&&i.site==="YouTube");if(t.length>0)return t[0];throw new Error("Trailer not found")}catch(s){throw console.error("Error fetching movie trailer:",s),s}},ee=async o=>{try{const s=await X(o);console.log(`Found movie: ${s.title} (ID: ${s.id})`);const t=await Z(s.id);return console.log(`Found trailer: ${t.name} (Key: ${t.key})`),`https://www.youtube.com/embed/${t.key}`}catch(s){throw console.error("Error finding and playing trailer:",s),s}},se="_modal_62xv9_1",te="_modalContent_62xv9_14",oe="_close_62xv9_31",x={modal:se,modalContent:te,close:oe},re=({isOpen:o,trailerUrl:s,errorMessage:t,onClose:i})=>o?e.jsx("div",{className:x.modal,children:e.jsxs("div",{className:x.modalContent,children:[e.jsx("button",{className:x.close,onClick:i,children:"×"}),t?e.jsx("p",{className:x.error,children:t}):e.jsx("iframe",{width:"560",height:"315",src:s,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:"Trailer"})]})}):null,ie="http://localhost:4444",ae=({items:o,onDeleteMovie:s})=>{const t=d.useRef(null),i=$(),[c,m]=d.useState(!1),[j,v]=d.useState(""),[f,h]=d.useState(""),u=(n,a)=>{i(A({id:n,favorite:!a}))},p=async n=>{try{const a=await ee(n);v(a),m(!0)}catch(a){h(a.message||"An unexpected error occurred.")}},C=()=>{m(!1),v(""),h("")},F=o.map(({_id:n,title:a,director:b,genre:g,poster:_,releaseDate:M,favorite:y})=>e.jsxs("li",{className:l.listItem,children:[_&&e.jsx("div",{className:l.posterWrapper,children:e.jsx("img",{ref:t,className:l.listItemPoster,src:`${ie}/${_}`,alt:`Poster for ${a}`})}),e.jsxs("div",{className:l.listItemInfo,children:[e.jsxs("h2",{children:["Назва: ",a]}),e.jsxs("span",{children:["Director: ",b]}),e.jsxs("span",{children:["Genre: ",g]}),e.jsxs("span",{children:["Release: ",M]})]}),e.jsx("button",{children:e.jsx("svg",{onClick:()=>u(n,y),className:`${l.like} ${y?l.likeActive:""}`,children:e.jsx("use",{href:`${N}#icon-heart`})})}),e.jsx("button",{onClick:()=>p(a),children:e.jsx("svg",{className:l.video,children:e.jsx("use",{href:`${N}#icon-video`})})}),e.jsx("button",{className:l.button,onClick:()=>s(n),children:"Delete"}),e.jsx(G,{movie:{_id:n,title:a,director:b,genre:g,poster:_,releaseDate:M,favorite:y},className:l.btnEdit})]},n));return e.jsxs("div",{children:[e.jsx("ol",{className:l.list,children:F}),e.jsx(re,{isOpen:c,trailerUrl:j,errorMessage:f,onClose:C})]})},le={title:"",director:"",favorite:!1,genre:"fantastic",releaseDate:"",poster:null},ne=({onSubmit:o})=>{const{state:s,handleChange:t,reset:i}=B({initialState:le,onSubmit:o}),c=u=>{u.preventDefault();const p=new FormData(u.currentTarget);p.set("favorite",s.favorite),o(p),i()},{title:m,director:j,favorite:v,releaseDate:f}=s,h=[/\d/,/\d/,/\d/,/\d/];return e.jsxs("form",{onSubmit:c,className:r.form,encType:"multipart/form-data",children:[e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{children:"Movie title"}),e.jsx("input",{value:m,name:"title",onChange:t,className:r.textField,placeholder:"Movie title",required:!0})]}),e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{children:"Movie director"}),e.jsx("input",{value:j,name:"director",onChange:t,className:r.textField,placeholder:"Movie director",required:!0})]}),e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{children:"Favorite"}),e.jsx("input",{checked:v,name:"favorite",onChange:t,className:r.checkbox,type:"checkbox"})]}),e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{children:"Movie genre"}),e.jsxs("select",{name:"genre",onChange:t,children:[e.jsx("option",{value:"fantastic",children:"Fantastic"}),e.jsx("option",{value:"love story",children:"Love story"})]})]}),e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{children:"Movie release date"}),e.jsx(R,{mask:h,value:f,name:"releaseDate",onChange:t,className:r.textField,placeholder:"YYYY",required:!0})]}),e.jsxs("div",{className:r.formGroup,children:[e.jsx("label",{children:"Poster"}),e.jsx("input",{name:"poster",type:"file"})]}),e.jsx("button",{className:r.btn,type:"submit",children:"Add movie"})]})},ce="_title_xta3q_1",de="_blocks_xta3q_8",me={title:ce,blocks:de},ve=()=>{const o=D(U),s=$();d.useEffect(()=>{s(P())},[s]);const t=c=>{s(S(c))},i=c=>{s(q(c))};return e.jsx("div",{children:e.jsxs("div",{className:me.blocks,children:[e.jsx(k,{title:"Add movie",children:e.jsx(ne,{onSubmit:t})}),e.jsx(k,{title:"Movie list",children:o.length>0?e.jsx(ae,{items:o,onDeleteMovie:i}):e.jsx(w,{children:"No movies have been added yet"})})]})})},xe=()=>e.jsxs("div",{children:[e.jsx(w,{children:"My movies page"}),e.jsx(ve,{})]});export{xe as default};
