import{a as N,r as d,u as k,j as e,b as A,c as F,f as P,d as D,e as S}from"./index-55318867.js";import{i as M,E as R,s as a,M as q,g as B,a as I}from"./movies-selectors-3431ccd4.js";import{u as G,T as E}from"./useForm-0f319b49.js";const U="_list_1d4xt_1",Y="_listItem_1d4xt_10",L="_posterWrapper_1d4xt_22",V="_listItemPoster_1d4xt_34",W="_listItemInfo_1d4xt_46",K="_like_1d4xt_60",O="_likeActive_1d4xt_70",z="_video_1d4xt_75",H="_button_1d4xt_92",J="_btnEdit_1d4xt_115",Q="_modal_1d4xt_141",X="_modalContent_1d4xt_154",Z="_close_1d4xt_171",r={list:U,listItem:Y,posterWrapper:L,listItemPoster:V,listItemInfo:W,like:K,likeActive:O,video:z,button:H,btnEdit:J,modal:Q,modalContent:X,close:Z},w={}.VITE_BASE_URL,$={}.VITE_API_KEY,ee=async o=>{try{const t=await N.get(`${w}/search/movie?api_key=${$}&query=${encodeURIComponent(o)}&page=1`);if(t.data.results.length===0)throw new Error("No movies found for the provided query");return t.data.results[0]}catch(t){throw console.error("Error fetching movie by name:",t),t}},te=async o=>{try{const s=(await N.get(`${w}/movie/${o}/videos?api_key=${$}`)).data.results.filter(l=>l.type==="Trailer"&&l.site==="YouTube");if(s.length>0)return s[0];throw new Error("Trailer not found")}catch(t){throw console.error("Error fetching movie trailer:",t),t}},se=async o=>{try{const t=await ee(o);console.log(`Found movie: ${t.title} (ID: ${t.id})`);const s=await te(t.id);return console.log(`Found trailer: ${s.name} (Key: ${s.key})`),`https://www.youtube.com/embed/${s.key}`}catch(t){throw console.error("Error finding and playing trailer:",t),t}},re="http://localhost:4444",oe=({items:o,onDeleteMovie:t})=>{const s=d.useRef(null),l=k(),[c,m]=d.useState(!1),[j,h]=d.useState(""),[u,x]=d.useState(""),v=(n,i)=>{l(A({id:n,favorite:!i}))},p=async n=>{try{const i=await se(n);h(i),m(!0)}catch(i){x(i.message||"An unexpected error occurred.")}},T=()=>{m(!1),h(""),x("")},C=o.map(({_id:n,title:i,director:y,genre:g,poster:_,releaseDate:b,favorite:f})=>e.jsxs("li",{className:r.listItem,children:[_&&e.jsx("div",{className:r.posterWrapper,children:e.jsx("img",{ref:s,className:r.listItemPoster,src:`${re}/${_}`,alt:`Poster for ${i}`})}),e.jsxs("div",{className:r.listItemInfo,children:[e.jsxs("h2",{children:["Назва: ",i]}),e.jsxs("span",{children:["Director: ",y]}),e.jsxs("span",{children:["Genre: ",g]}),e.jsxs("span",{children:["Release: ",b]})]}),e.jsx("button",{children:e.jsx("svg",{onClick:()=>v(n,f),className:`${r.like} ${f?r.likeActive:""}`,children:e.jsx("use",{href:`${M}#icon-heart`})})}),e.jsx("button",{onClick:()=>p(i),children:e.jsx("svg",{className:r.video,children:e.jsx("use",{href:`${M}#icon-video`})})}),e.jsx("button",{className:r.button,onClick:()=>t(n),children:"Delete"}),e.jsx(R,{movie:{_id:n,title:i,director:y,genre:g,poster:_,releaseDate:b,favorite:f},className:r.btnEdit})]},n));return e.jsxs("div",{children:[e.jsx("ol",{className:r.list,children:C}),c&&e.jsx("div",{className:r.modal,children:e.jsxs("div",{className:r.modalContent,children:[e.jsx("button",{className:r.close,onClick:T,children:"×"}),u?e.jsx("p",{className:r.error,children:u}):e.jsx("iframe",{width:"560",height:"315",src:j,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:"Trailer"})]})})]})},ae={title:"",director:"",favorite:!1,genre:"fantastic",releaseDate:"",poster:null},ie=({onSubmit:o})=>{const{state:t,handleChange:s,reset:l}=G({initialState:ae,onSubmit:o}),c=v=>{v.preventDefault();const p=new FormData(v.currentTarget);p.set("favorite",t.favorite),o(p),l()},{title:m,director:j,favorite:h,releaseDate:u}=t,x=[/\d/,/\d/,/\d/,/\d/];return e.jsxs("form",{onSubmit:c,className:a.form,encType:"multipart/form-data",children:[e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie title"}),e.jsx("input",{value:m,name:"title",onChange:s,className:a.textField,placeholder:"Movie title",required:!0})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie director"}),e.jsx("input",{value:j,name:"director",onChange:s,className:a.textField,placeholder:"Movie director",required:!0})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Favorite"}),e.jsx("input",{checked:h,name:"favorite",onChange:s,className:a.checkbox,type:"checkbox"})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie genre"}),e.jsxs("select",{name:"genre",onChange:s,children:[e.jsx("option",{value:"fantastic",children:"Fantastic"}),e.jsx("option",{value:"love story",children:"Love story"})]})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie release date"}),e.jsx(q,{mask:x,value:u,name:"releaseDate",onChange:s,className:a.textField,placeholder:"YYYY",required:!0})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Poster"}),e.jsx("input",{name:"poster",type:"file"})]}),e.jsx("button",{className:a.btn,type:"submit",children:"Add movie"})]})},le="_title_xta3q_1",ne="_blocks_xta3q_8",ce={title:le,blocks:ne},de=()=>{const o=F(B),t=k();d.useEffect(()=>{t(P())},[t]);const s=c=>{t(D(c))},l=c=>{t(S(c))};return e.jsx("div",{children:e.jsxs("div",{className:ce.blocks,children:[e.jsx(I,{title:"Add movie",children:e.jsx(ie,{onSubmit:s})}),e.jsx(I,{title:"Movie list",children:o.length>0?e.jsx(oe,{items:o,onDeleteMovie:l}):e.jsx(E,{children:"No movies have been added yet"})})]})})},xe=()=>e.jsxs("div",{children:[e.jsx(E,{children:"My movies page"}),e.jsx(de,{})]});export{xe as default};
