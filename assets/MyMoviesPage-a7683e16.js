import{a as N,j as e,r as v,u as k,b as E,c as C,f as F,d as A,e as D}from"./index-52a92a26.js";import{i as M,E as P,s as a,M as S,g as U,a as w}from"./movies-selectors-20c15d33.js";import{u as q,T as I}from"./useForm-af08f89a.js";const G="_list_1xdvw_1",R="_listItem_1xdvw_9",B="_posterWrapper_1xdvw_21",Y="_listItemPoster_1xdvw_33",L="_listItemInfo_1xdvw_45",O="_like_1xdvw_59",W="_likeActive_1xdvw_69",V="_video_1xdvw_74",K="_button_1xdvw_91",z="_btnEdit_1xdvw_114",l={list:G,listItem:R,posterWrapper:B,listItemPoster:Y,listItemInfo:L,like:O,likeActive:W,video:V,button:K,btnEdit:z},T="https://api.themoviedb.org/3",$="ba520957137ad46ba4502dabb5237445",H=async r=>{try{const s=await N.get(`${T}/search/movie?api_key=${$}&query=${encodeURIComponent(r)}&page=1`);if(s.data.results.length===0)throw new Error("No movies found for the provided query");return s.data.results[0]}catch(s){throw console.error("Error fetching movie by name:",s),s}},J=async r=>{try{const t=(await N.get(`${T}/movie/${r}/videos?api_key=${$}`)).data.results.filter(o=>o.type==="Trailer"&&o.site==="YouTube");if(t.length>0)return t[0];throw new Error("Trailer not found")}catch(s){throw console.error("Error fetching movie trailer:",s),s}},Q=async r=>{try{const s=await H(r);console.log(`Found movie: ${s.title} (ID: ${s.id})`);const t=await J(s.id);return console.log(`Found trailer: ${t.name} (Key: ${t.key})`),`https://www.youtube.com/embed/${t.key}`}catch(s){throw console.error("Error finding and playing trailer:",s),s}},X="_modal_62xv9_1",Z="_modalContent_62xv9_14",ee="_close_62xv9_31",j={modal:X,modalContent:Z,close:ee},se=({isOpen:r,trailerUrl:s,errorMessage:t,onClose:o})=>r?e.jsx("div",{className:j.modal,children:e.jsxs("div",{className:j.modalContent,children:[e.jsx("button",{className:j.close,onClick:o,children:"×"}),t?e.jsx("p",{className:j.error,children:t}):e.jsx("iframe",{width:"560",height:"315",src:s,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:"Trailer"})]})}):null,te=()=>{const[r,s]=v.useState(!1),[t,o]=v.useState(""),[i,c]=v.useState("");return{isModalOpen:r,currentTrailerUrl:t,errorMessage:i,playTrailer:async u=>{try{const d=await Q(u);o(d),c(""),s(!0)}catch(d){c(d.message||"An unexpected error occurred."),o(""),s(!0)}},closeModal:()=>{s(!1),o(""),c("")}}},re="http://localhost:4444",oe=({items:r,onDeleteMovie:s})=>{const t=v.useRef(null),o=k(),i=(n,m)=>{o(E({id:n,favorite:!m}))},{isModalOpen:c,currentTrailerUrl:h,errorMessage:x,playTrailer:u,closeModal:d}=te(),p=r.map(({_id:n,title:m,director:y,genre:b,poster:f,releaseDate:g,favorite:_})=>e.jsxs("li",{className:l.listItem,children:[f&&e.jsx("div",{className:l.posterWrapper,children:e.jsx("img",{ref:t,className:l.listItemPoster,src:`${re}/${f}`,alt:`Poster for ${m}`})}),e.jsxs("div",{className:l.listItemInfo,children:[e.jsxs("h2",{children:["Назва: ",m]}),e.jsxs("span",{children:["Director: ",y]}),e.jsxs("span",{children:["Genre: ",b]}),e.jsxs("span",{children:["Release: ",g]})]}),e.jsx("button",{children:e.jsx("svg",{onClick:()=>i(n,_),className:`${l.like} ${_?l.likeActive:""}`,children:e.jsx("use",{href:`${M}#icon-heart`})})}),e.jsx("button",{onClick:()=>u(m),children:e.jsx("svg",{className:l.video,children:e.jsx("use",{href:`${M}#icon-video`})})}),e.jsx("button",{className:l.button,onClick:()=>s(n),children:"Delete"}),e.jsx(P,{movie:{_id:n,title:m,director:y,genre:b,poster:f,releaseDate:g,favorite:_},className:l.btnEdit})]},n));return e.jsxs("div",{children:[e.jsx("ol",{className:l.list,children:p}),e.jsx(se,{isOpen:c,trailerUrl:h,errorMessage:x,onClose:d})]})},ae={title:"",director:"",favorite:!1,genre:"fantastic",releaseDate:"",poster:null},le=({onSubmit:r})=>{const{state:s,handleChange:t,reset:o}=q({initialState:ae,onSubmit:r}),i=p=>{p.preventDefault();const n=new FormData(p.currentTarget);n.set("favorite",s.favorite),r(n),o()},{title:c,director:h,favorite:x,releaseDate:u}=s,d=[/\d/,/\d/,/\d/,/\d/];return e.jsxs("form",{onSubmit:i,className:a.form,encType:"multipart/form-data",children:[e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie title"}),e.jsx("input",{value:c,name:"title",onChange:t,className:a.textField,placeholder:"Movie title",required:!0})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie director"}),e.jsx("input",{value:h,name:"director",onChange:t,className:a.textField,placeholder:"Movie director",required:!0})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Favorite"}),e.jsx("input",{checked:x,name:"favorite",onChange:t,className:a.checkbox,type:"checkbox"})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie genre"}),e.jsxs("select",{name:"genre",onChange:t,children:[e.jsx("option",{value:"fantastic",children:"Fantastic"}),e.jsx("option",{value:"love story",children:"Love story"})]})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Movie release date"}),e.jsx(S,{mask:d,value:u,name:"releaseDate",onChange:t,className:a.textField,placeholder:"YYYY",required:!0})]}),e.jsxs("div",{className:a.formGroup,children:[e.jsx("label",{children:"Poster"}),e.jsx("input",{name:"poster",type:"file"})]}),e.jsx("button",{className:a.btn,type:"submit",children:"Add movie"})]})},ie="_title_xta3q_1",ne="_blocks_xta3q_8",ce={title:ie,blocks:ne},de=()=>{const r=C(U),s=k();v.useEffect(()=>{s(F())},[s]);const t=i=>{s(A(i))},o=i=>{s(D(i))};return e.jsx("div",{children:e.jsxs("div",{className:ce.blocks,children:[e.jsx(w,{title:"Add movie",children:e.jsx(le,{onSubmit:t})}),e.jsx(w,{title:"Movie list",children:r.length>0?e.jsx(oe,{items:r,onDeleteMovie:o}):e.jsx(I,{children:"No movies have been added yet"})})]})})},he=()=>e.jsxs("div",{children:[e.jsx(I,{children:"My movies page"}),e.jsx(de,{})]});export{he as default};
