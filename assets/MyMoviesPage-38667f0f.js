import{a as N,r as d,u as k,j as e,b as C,c as F,f as P,d as D,e as S}from"./index-5531e126.js";import{i as M,E as R,s as i,M as q,g as B,a as I}from"./movies-selectors-6c11bbea.js";import{u as G,T as E}from"./useForm-e3a2f229.js";const U="_list_1io6v_1",Y="_listItem_1io6v_10",L="_posterWrapper_1io6v_22",V="_listItemPoster_1io6v_34",W="_listItemInfo_1io6v_46",K="_like_1io6v_60",O="_likeActive_1io6v_70",z="_video_1io6v_75",H="_button_1io6v_92",J="_btnEdit_1io6v_115",r={list:U,listItem:Y,posterWrapper:L,listItemPoster:V,listItemInfo:W,like:K,likeActive:O,video:z,button:H,btnEdit:J},w={}.VITE_BASE_URL,$={}.VITE_API_KEY,Q=async o=>{try{const s=await N.get(`${w}/search/movie?api_key=${$}&query=${encodeURIComponent(o)}&page=1`);if(s.data.results.length===0)throw new Error("No movies found for the provided query");return s.data.results[0]}catch(s){throw console.error("Error fetching movie by name:",s),s}},X=async o=>{try{const t=(await N.get(`${w}/movie/${o}/videos?api_key=${$}`)).data.results.filter(l=>l.type==="Trailer"&&l.site==="YouTube");if(t.length>0)return t[0];throw new Error("Trailer not found")}catch(s){throw console.error("Error fetching movie trailer:",s),s}},Z=async o=>{try{const s=await Q(o);console.log(`Found movie: ${s.title} (ID: ${s.id})`);const t=await X(s.id);return console.log(`Found trailer: ${t.name} (Key: ${t.key})`),`https://www.youtube.com/embed/${t.key}`}catch(s){throw console.error("Error finding and playing trailer:",s),s}},ee="http://localhost:4444",se=({items:o,onDeleteMovie:s})=>{const t=d.useRef(null),l=k(),[c,m]=d.useState(!1),[j,h]=d.useState(""),[v,u]=d.useState(""),p=(n,a)=>{l(C({id:n,favorite:!a}))},x=async n=>{try{const a=await Z(n);h(a),m(!0)}catch(a){u(a.message||"An unexpected error occurred.")}},T=()=>{m(!1),h(""),u("")},A=o.map(({_id:n,title:a,director:y,genre:g,poster:f,releaseDate:b,favorite:_})=>e.jsxs("li",{className:r.listItem,children:[f&&e.jsx("div",{className:r.posterWrapper,children:e.jsx("img",{ref:t,className:r.listItemPoster,src:`${ee}/${f}`,alt:`Poster for ${a}`})}),e.jsxs("div",{className:r.listItemInfo,children:[e.jsxs("h2",{children:["Назва: ",a]}),e.jsxs("span",{children:["Director: ",y]}),e.jsxs("span",{children:["Genre: ",g]}),e.jsxs("span",{children:["Release: ",b]})]}),e.jsx("button",{children:e.jsx("svg",{onClick:()=>p(n,_),className:`${r.like} ${_?r.likeActive:""}`,children:e.jsx("use",{href:`${M}#icon-heart`})})}),e.jsx("button",{onClick:()=>x(a),children:e.jsx("svg",{className:r.video,children:e.jsx("use",{href:`${M}#icon-video`})})}),e.jsx("button",{className:r.button,onClick:()=>s(n),children:"Delete"}),e.jsx(R,{movie:{_id:n,title:a,director:y,genre:g,poster:f,releaseDate:b,favorite:_},className:r.btnEdit})]},n));return e.jsxs("div",{children:[e.jsx("ol",{className:r.list,children:A}),c&&e.jsx("div",{className:r.modal,children:e.jsxs("div",{className:r.modalContent,children:[e.jsx("button",{className:r.close,onClick:T,children:"×"}),v?e.jsx("p",{className:r.error,children:v}):e.jsx("iframe",{width:"560",height:"315",src:j,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:"Trailer"})]})})]})},te={title:"",director:"",favorite:!1,genre:"fantastic",releaseDate:"",poster:null},re=({onSubmit:o})=>{const{state:s,handleChange:t,reset:l}=G({initialState:te,onSubmit:o}),c=p=>{p.preventDefault();const x=new FormData(p.currentTarget);x.set("favorite",s.favorite),o(x),l()},{title:m,director:j,favorite:h,releaseDate:v}=s,u=[/\d/,/\d/,/\d/,/\d/];return e.jsxs("form",{onSubmit:c,className:i.form,encType:"multipart/form-data",children:[e.jsxs("div",{className:i.formGroup,children:[e.jsx("label",{children:"Movie title"}),e.jsx("input",{value:m,name:"title",onChange:t,className:i.textField,placeholder:"Movie title",required:!0})]}),e.jsxs("div",{className:i.formGroup,children:[e.jsx("label",{children:"Movie director"}),e.jsx("input",{value:j,name:"director",onChange:t,className:i.textField,placeholder:"Movie director",required:!0})]}),e.jsxs("div",{className:i.formGroup,children:[e.jsx("label",{children:"Favorite"}),e.jsx("input",{checked:h,name:"favorite",onChange:t,className:i.checkbox,type:"checkbox"})]}),e.jsxs("div",{className:i.formGroup,children:[e.jsx("label",{children:"Movie genre"}),e.jsxs("select",{name:"genre",onChange:t,children:[e.jsx("option",{value:"fantastic",children:"Fantastic"}),e.jsx("option",{value:"love story",children:"Love story"})]})]}),e.jsxs("div",{className:i.formGroup,children:[e.jsx("label",{children:"Movie release date"}),e.jsx(q,{mask:u,value:v,name:"releaseDate",onChange:t,className:i.textField,placeholder:"YYYY",required:!0})]}),e.jsxs("div",{className:i.formGroup,children:[e.jsx("label",{children:"Poster"}),e.jsx("input",{name:"poster",type:"file"})]}),e.jsx("button",{className:i.btn,type:"submit",children:"Add movie"})]})},oe="_title_xta3q_1",ie="_blocks_xta3q_8",ae={title:oe,blocks:ie},le=()=>{const o=F(B),s=k();d.useEffect(()=>{s(P())},[s]);const t=c=>{s(D(c))},l=c=>{s(S(c))};return e.jsx("div",{children:e.jsxs("div",{className:ae.blocks,children:[e.jsx(I,{title:"Add movie",children:e.jsx(re,{onSubmit:t})}),e.jsx(I,{title:"Movie list",children:o.length>0?e.jsx(se,{items:o,onDeleteMovie:l}):e.jsx(E,{children:"No movies have been added yet"})})]})})},me=()=>e.jsxs("div",{children:[e.jsx(E,{children:"My movies page"}),e.jsx(le,{})]});export{me as default};
